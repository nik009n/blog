{% extends 'base.html' %} 
{% load static %} 
{% block title %} 
{{ post.title_tag}} 
{% endblock %} 
{% block content %}

<h1>{{ post.title }}</h1>
<small>
  
  
  By : {{ post.author.first_name }} {{ post.author.last_name }} - {{ post.post_date }} 
  
</small>
{% if user.is_authenticated %} {% if user.id == post.author.id %}
<a href="{% url 'update_post' post.pk %}">Edit</a>
<a href="{% url 'delete_post' post.pk %}">Delete</a>
{% endif %} {% endif %}
<br />
<hr />
<br />
{% if post.header_image %}
<img src="{{ post.header_image.url }}" />
{% endif %}
<br /><br />
{{ post.body | safe}}
<!-- By default django doesn't permit HTML for posts due to security reasons. So to apply our own formatting we can use the 'safe'. For this to work we also need to apply HTML formatting in the add post field. Also to make sure those HTML elements in the add post field won't show up in the home page we need to add the 'safe' in the home.html file -->

<!-- Here we use 'user.id' and 'post.author.id to make sure only the author can edit and delete posts. This 'id' is automatically generated by django since we used 'User' as an argument in 'author' field in our model.-->

<!-- Here post.header_image.url is used because 'header_image' is the name of the field in our model. We include it in a img src tag so that the image will be displayed on the page. Here we put all this inside an if statement to make sure posts without an image is also allowed in the blog. -->

<br /><br />

<br /><br />
<hr />
<br />
<!-- Creating a form to make a like button in our posts -->
<form action="{% url 'like_post' post.pk %}" method="POST">
  {% csrf_token %}
  <!-- To make sure only users who are logged in can like the posts. -->
  {% if user.is_authenticated %} {% if liked %}
  <button
    type="submit"
    ,
    name="post_id"
    ,
    value="{{ post.id }}"
    ,
    class="btn btn-warning btn-sm"
  >
    Unlike
  </button>
  - {% else %}
  <button
    type="submit"
    ,
    name="post_id"
    ,
    value="{{ post.id }}"
    ,
    class="btn btn-primary btn-sm"
  >
    Like
  </button>
  -
  <!-- Here we assign value={{ post.id }} which will pass post.id as the value to the backend to keep track of which post is getting the likes -->
  {% endif %} {{ total_likes }} Likes {% else %}
  <small> Login to like the post</small>
  {% endif %}
</form>
<br /><br />
<!-- Here we add the author information like profile pic, social media links etc. We created the Profile model in models.py.  -->

<div class="card mb-3">
  <div class="row g-0">
    <div class="col-md-2">
      {% if post.author.profile.profile_pic %}
      <img
        src="{{ post.author.profile.profile_pic.url }}"
        width="150"
        height="200"
        alt="..."
      />
      {% else %}
      <img
        src="{% static 'theblog/images/default_profile_pic.jpg' %}"
        width="150"
        height="200"
        alt="..."
      />
      {% endif %}
    </div>
    <div class="col-md-10">
      <div class="card-body">
        <h5 class="card-title">
          {{ post.author.first_name }} {{ post.author.last_name }}
        </h5>
        

        <p class="card-text text-muted">
          <!-- To view the posts of users who hasn't made a profile page before making a post. -->
          {% if  post.author.profile.id %}
          <a href="{% url 'show_profile_page' post.author.profile.id %}"
            >Profile Page |</a
          >
          {% endif %}
          <!-- Putting the links inside an if statement so that the links will only be displayed if the user has entered it in the profile page. -->
          {% if post.author.profile.website_url %}
          <a href="{{ post.author.profile.website_url }}">Facebook |</a>
          {% endif %} {% if post.author.profile.facebook_url %}
          <a href="{{ post.author.profile.facebook_url }}">Facebook |</a>
          {% endif %} {% if post.author.profile.twitter_url %}
          <a href="{{ post.author.profile.twitter_url }}">Twitter |</a>
          {% endif %} {% if post.author.profile.instagram_url %}
          <a href="{{ post.author.profile.instagram_url }}">Instagram</a>
          {% endif %} {% if post.author.profile.pinterest_url %}
          <a href="{{ post.author.profile.pinterest_url }}">Instagram</a>
          {% endif %}
        </p>
        <p class="card-text">{{ post.author.profile.bio }}</p>
      </div>
    </div>
  </div>
</div>

<!-- To add a comments section -->
<!-- Here post.comments.all is used since we associate the post model in the Comment model and used 'comments' because we used related_name="comments" in the post field and all is used for fetching all the comments. -->
<br /><br />
<h2>Comments</h2>
<hr />
{% if not post.comments.all %} No comments yet <br />
<a href="{% url 'add_comment' post.pk %}">Add one</a><br /><br />
{% else %}
<a href="{% url 'add_comment' post.pk %}">Add Comment</a><br /><br />
{% for comment in post.comments.all %}
<strong>
  {{ comment.name }} {{ comment.date_added }}
  <br />
</strong>
{{ comment.body }}
<br />
<br />
{% endfor %}
<br />
<hr />
<br />
<a href="{% url 'add_comment' post.pk %}">Add Comment</a><br /><br />
<br/><br/>
{% endif %} 
{% endblock %}
